{
  "active": false,
  "connections": {
    "Webhook1": {
      "main": [
        [
          {
            "node": "Hora atual",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Verifica HorÃ¡rio Comercial e Feriado": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When Executed by Another Workflow": {
      "main": [
        [
          {
            "node": "Hora_atual",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Verifica HorÃ¡rio Comercial e Feriado1": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "EncaminhaAtendente",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ForaHorario",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "EncaminhaAtendente": {
      "main": [
        [
          {
            "node": "AtendenteEncaminhado",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "encaminhar_atendente": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Hora atual": {
      "main": [
        [
          {
            "node": "Verifica HorÃ¡rio Comercial e Feriado",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Hora_atual": {
      "main": [
        [
          {
            "node": "Verifica HorÃ¡rio Comercial e Feriado1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-11-15T19:06:34.035Z",
  "id": "foY9UtzLLzhdJUmk",
  "isArchived": false,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "Agente Atendimento E-commerce - Encaminha Atendente",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "6cbb9f45-9ff9-4d31-8bed-6235b82aecda",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        0,
        0
      ],
      "id": "eaf4f10e-b148-49cb-94dc-ee16f7bc08e4",
      "name": "Webhook1",
      "webhookId": "6cbb9f45-9ff9-4d31-8bed-6235b82aecda"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Motivo do usuÃ¡rio para passar para atendente:  {{ $('Webhook1').item.json.body.motivo }}",
        "options": {
          "systemMessage": "=VocÃª Ã© um agente assistente do Pinc Suporte, um assistente de atendimento com IA da pincbar.\n\nâš ï¸ REGRAS CRÃTICAS (SIGA EXATAMENTE):\n\nVocÃª receberÃ¡ duas variÃ¡veis:\n- `isHorarioComercial`: {{ $json.isHorarioComercial }}\n- `isFeriado`: {{ $json.isFeriado }}\n\n### ðŸ”’ VocÃª sÃ³ pode chamar a ferramenta `encaminhar_atendente` se:\n- isHorarioComercial for **true**, **e**\n- isFeriado for **false**\n\nðŸš« EM TODOS OS OUTROS CASOS, VOCÃŠ **NÃƒO DEVE CHAMAR QUALQUER TOOL**.\n\nâŒ Se vocÃª chamar a tool `encaminhar_atendente` fora dessas condiÃ§Ãµes, isso causarÃ¡ um erro grave no atendimento. NÃƒO FAÃ‡A ISSO.\n\n---\n\nðŸ“… Data e hora atual: {{ $('Hora atual').item.json.Data_Hora_Atual }}\n\nðŸ“† Lista de feriados:\n- 2025-04-21 (Tiradentes)\n\n---\n\n### âœ… INSTRUÃ‡Ã•ES FINAIS\n\n**Se `isFeriado` for true:**\nResponda APENAS com a seguinte frase:\n> \"No momento estamos fora do horÃ¡rio de atendimento (9hâ€‘17h). Envie sua solicitaÃ§Ã£o para **contato@pincbar.com.br** que responderemos o mais breve possÃ­vel! âœ¨ (Obs: hoje Ã© feriado, nÃ£o estamos trabalhando.)\"\n\n**Se `isHorarioComercial` for false:**\nResponda:\n> \"No momento estamos fora do horÃ¡rio de atendimento (9hâ€‘17h). Envie sua solicitaÃ§Ã£o para **contato@pincbar.com.br** que responderemos o mais breve possÃ­vel! âœ¨\"\n\n**Se estiver tudo certo (dentro do horÃ¡rio e nÃ£o for feriado):**\nChame a ferramenta `encaminhar_atendente`.\n\n---\n\nâ—LEMBRE-SE:\nSÃ³ chame a tool `encaminhar_atendente` se **isHorarioComercial = true** **e** **isFeriado = false**."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.9,
      "position": [
        832,
        0
      ],
      "id": "67005063-73fa-49fb-b842-c25003e0e9b0",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1-mini-2025-04-14",
          "mode": "list",
          "cachedResultName": "gpt-4.1-mini-2025-04-14"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        752,
        224
      ],
      "id": "29da49ac-4706-4349-93b9-7b7580c3d786",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "9tAaYio9SqQQ0jDd",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{ $json.output }}",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        1424,
        0
      ],
      "id": "791c7bb6-5754-4e16-b0f9-ae5719cddf2b",
      "name": "Respond to Webhook"
    },
    {
      "parameters": {
        "jsCode": "const dataStr = $json.Data_Hora_Atual;\n\n// Exemplo do formato: \"Agora Ã© 16:23 e o dia Ã© 21-04-2025 no horÃ¡rio de BrasÃ­lia\"\n// Vamos extrair hora e data com regex\nconst match = dataStr.match(/(\\d{2}):(\\d{2}).*?(\\d{2})-(\\d{2})-(\\d{4})/);\n\nif (!match) {\n  return [{\n    json: {\n      erro: \"Formato invÃ¡lido de Data_Hora_Atual\",\n      isHorarioComercial: false,\n      isFeriado: false\n    }\n  }];\n}\n\n// ExtraÃ§Ã£o da hora e data\nconst hora = parseInt(match[1]);\nconst minuto = parseInt(match[2]);\nconst dia = parseInt(match[3]);\nconst mes = parseInt(match[4]) - 1; // JS conta meses de 0 a 11\nconst ano = parseInt(match[5]);\n\n// CriaÃ§Ã£o do objeto Date\nconst data = new Date(ano, mes, dia, hora, minuto);\nconst diaSemana = data.getDay(); // 0 = domingo ... 6 = sÃ¡bado\n\n// VerificaÃ§Ã£o de horÃ¡rio comercial\nconst dentroDoHorario = hora >= 9 && hora < 17;\nconst diaUtil = diaSemana >= 1 && diaSemana <= 5;\nconst isHorarioComercial = dentroDoHorario && diaUtil;\n\n// VerificaÃ§Ã£o de feriado\nconst dataFormatada = `${ano}-${(mes+1).toString().padStart(2, '0')}-${dia.toString().padStart(2, '0')}`;\nconst feriados = ['2025-04-21']; // Adicione mais aqui se quiser\nconst isFeriado = feriados.includes(dataFormatada);\n\n// Resultado final\nreturn [{\n  json: {\n    isHorarioComercial,\n    isFeriado\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        464,
        0
      ],
      "id": "4524f75c-c419-4186-ac65-40a2db486e4d",
      "name": "Verifica HorÃ¡rio Comercial e Feriado"
    },
    {
      "parameters": {
        "workflowInputs": {
          "values": [
            {
              "name": "sessionId"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        288,
        608
      ],
      "id": "2a0ece96-f691-4d64-9dbf-5c0d67f29fd1",
      "name": "When Executed by Another Workflow"
    },
    {
      "parameters": {
        "jsCode": "const dataStr = $json.Data_Hora_Atual;\n\n// Exemplo do formato: \"Agora Ã© 16:23 e o dia Ã© 21-04-2025 no horÃ¡rio de BrasÃ­lia\"\n// Vamos extrair hora e data com regex\nconst match = dataStr.match(/(\\d{2}):(\\d{2}).*?(\\d{2})-(\\d{2})-(\\d{4})/);\n\nif (!match) {\n  return [{\n    json: {\n      erro: \"Formato invÃ¡lido de Data_Hora_Atual\",\n      isHorarioComercial: false,\n      isFeriado: false\n    }\n  }];\n}\n\n// ExtraÃ§Ã£o da hora e data\nconst hora = parseInt(match[1]);\nconst minuto = parseInt(match[2]);\nconst dia = parseInt(match[3]);\nconst mes = parseInt(match[4]) - 1; // JS conta meses de 0 a 11\nconst ano = parseInt(match[5]);\n\n// CriaÃ§Ã£o do objeto Date\nconst data = new Date(ano, mes, dia, hora, minuto);\nconst diaSemana = data.getDay(); // 0 = domingo ... 6 = sÃ¡bado\n\n// VerificaÃ§Ã£o de horÃ¡rio comercial\nconst dentroDoHorario = hora >= 9 && hora < 17;\nconst diaUtil = diaSemana >= 1 && diaSemana <= 5;\nconst isHorarioComercial = dentroDoHorario && diaUtil;\n\n// VerificaÃ§Ã£o de feriado\nconst dataFormatada = `${ano}-${(mes+1).toString().padStart(2, '0')}-${dia.toString().padStart(2, '0')}`;\nconst feriados = ['2025-04-21']; // Adicione mais aqui se quiser\nconst isFeriado = feriados.includes(dataFormatada);\n\n// Resultado final\nreturn [{\n  json: {\n    isHorarioComercial,\n    isFeriado\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        784,
        608
      ],
      "id": "2dcaa560-13a5-4152-a3f0-9c888fc23771",
      "name": "Verifica HorÃ¡rio Comercial e Feriado1"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "09757bc2-3f96-439a-bc77-a22927f73ffd",
              "leftValue": "={{ $json.isHorarioComercial }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            },
            {
              "id": "03d90203-1033-45c6-9d58-a1c50e0c5bbf",
              "leftValue": "={{ $json.isFeriado }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1008,
        608
      ],
      "id": "7936d48a-3663-4d60-a2e4-1f38834c9862",
      "name": "If"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "3f4cb3e8-3f9f-4e80-8110-7357c3a6a503",
              "name": "Resposta",
              "value": "Avise o cliente que estamos fora do HorÃ¡rio de Atendimento",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1232,
        704
      ],
      "id": "b87419dd-917a-4116-8f97-ce5ef0e25909",
      "name": "ForaHorario"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=URL CHATWOOT",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "api_access_token",
              "value": "TOKEN AQUI"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "{\n  \"assignee_id\": 5,\n  \"team_id\": 1\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1232,
        512
      ],
      "id": "bd7890de-ac63-44fd-b37b-0ae61e9ce7a0",
      "name": "EncaminhaAtendente"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "404e5df2-2819-4ad5-94e5-66d3e5af799f",
              "name": "AtendenteEncaminhado",
              "value": "Encaminhado para atendente",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1440,
        512
      ],
      "id": "abe0e6c8-7a6b-489c-b908-31933feecfdd",
      "name": "AtendenteEncaminhado"
    },
    {
      "parameters": {
        "name": "encaminhar_atendente",
        "description": "Ãºtil para encaminhar para atendente.",
        "workflowId": {
          "__rl": true,
          "mode": "id",
          "value": "SXNh0TNuG6wU5BeK"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "sessionId": "={{ $('Webhook1').item.json.body.sessionId }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "sessionId",
              "displayName": "sessionId",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.1,
      "position": [
        1104,
        272
      ],
      "id": "003b0011-179e-4ec0-879d-a5b4630872f4",
      "name": "encaminhar_atendente"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "5d7bc2d4-17ae-4b4d-b866-c9f70f9db0e1",
              "name": "Data_Hora_Atual",
              "value": "=Agora Ã© {{ $now.setLocale('pt-BR').format('HH:mm') }} e o dia Ã© {{ $now.setLocale('pt-BR').format('dd-MM-yyyy') }} no horÃ¡rio de BrasÃ­lia",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        224,
        0
      ],
      "id": "33f368de-39b6-4892-a399-d1eb42185f9c",
      "name": "Hora atual"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "5d7bc2d4-17ae-4b4d-b866-c9f70f9db0e1",
              "name": "Data_Hora_Atual",
              "value": "=Agora Ã© {{ $now.setLocale('pt-BR').format('HH:mm') }} e o dia Ã© {{ $now.setLocale('pt-BR').format('dd-MM-yyyy') }} no horÃ¡rio de BrasÃ­lia",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        528,
        608
      ],
      "id": "af8614db-07fe-4bb2-ac9c-67fb82bef8ef",
      "name": "Hora_atual"
    }
  ],
  "pinData": {
    "Webhook1": [
      {
        "json": {
          "headers": {
            "host": "n8n.outoflow.online",
            "user-agent": "axios/1.8.2",
            "content-length": "96",
            "accept": "application/json, text/plain, */*",
            "accept-encoding": "gzip, compress, deflate, br",
            "content-type": "application/json",
            "x-forwarded-for": "172.18.0.1",
            "x-forwarded-host": "n8n.outoflow.online",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "134a11703900",
            "x-real-ip": "172.18.0.1"
          },
          "params": {},
          "query": {},
          "body": {
            "sessionId": 358,
            "motivo": "chamar atendente"
          },
          "webhookUrl": "https://webhook.outoflow.online/webhook/6cbb9f45-9ff9-4d31-8bed-6235b82aecda",
          "executionMode": "production"
        }
      }
    ],
    "When Executed by Another Workflow": [
      {
        "json": {
          "sessionId": 1455
        }
      }
    ]
  },
  "settings": {
    "executionOrder": "v1"
  },
  "shared": [
    {
      "updatedAt": "2025-11-15T19:06:34.038Z",
      "createdAt": "2025-11-15T19:06:34.038Z",
      "role": "workflow:owner",
      "workflowId": "foY9UtzLLzhdJUmk",
      "projectId": "NmjiBPxycE3xYO0z"
    }
  ],
  "staticData": null,
  "tags": [],
  "triggerCount": 0,
  "updatedAt": "2025-11-15T19:06:36.000Z",
  "versionId": "4ace33cc-af16-4962-b929-e22e944b3fcd"
}